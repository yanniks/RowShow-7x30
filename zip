#!/bin/bash
DATE=$(date +%Y%m%d-%H%M)
PWD=$(pwd)
# cleanup
rm -v ~/AnyKernel/{kernel/zImage,system/lib/modules/*}
# copy files
find . -name "*.ko" -exec cp -v {} ~/AnyKernel/system/lib/modules/ \;
cp -v arch/arm/boot/zImage ~/AnyKernel/kernel/zImage
# zip it
if [ -z "$EXTRAVERSION" ]
then
  cd ~/AnyKernel
  export ZIPFILENAME=kernel-$DATE.zip
  zip -r9 ~/kernel-$DATE.zip *
  export UPDATEZIP=~/$ZIPFILENAME
else
  cd ~/AnyKernel
  export ZIPFILENAME=kernel-$DATE-$EXTRAVERSION.zip
  zip -r9 ~/$ZIPFILENAME *
  export UPDATEZIP=~/$ZIPFILENAME
fi
# return
cd $PWD
